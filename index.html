<!DOCTYPE html>
<!-- Seven Wonders HeptaSpiral ✨  v2.1  (Adaptive-Galaxy Edition)
     -----------------------------------------------------------------
     • Dims brightness at high recursion → less visual overload
     • Auto‑adds deeper detail when you zoom so clarity persists
     • Alpha fades by level, adjustable with BRIGHTNESS knob
     • Still mouse‑wheel zoom / slider depth / Randomize button
     ------------------------------------------------------------------> 
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Seven Wonders Fractal — HeptaSpiral Nebula</title>
  <style>
    html,body{margin:0;height:100%;overflow:hidden;background:#000;font-family:monospace;color:#fff}
    #ui{position:fixed;top:10px;left:10px;z-index:10;user-select:none}
    label{margin-right:8px}
    button{margin-left:8px;cursor:pointer;border:none;padding:4px 8px;border-radius:4px;background:#222;color:#0ff}
    button:hover{background:#0ff;color:#222}
  </style>
</head>
<body>
  <canvas id="c"></canvas>

  <!-- Control panel -->
  <div id="ui">
    <label>
      Depth <input id="depth" type="range" min="1" max="7" value="5">
    </label>
    <label>
      Brightness <input id="bright" type="range" min="0.3" max="1" step="0.05" value="0.7">
    </label>
    <button id="reset">Randomize ✨</button>
  </div>

  <script>
  // ───────────── CONSTANTS ─────────────
  const WONDERS = 7;                      // fractal arms
  const PHI     = (1+Math.sqrt(5))/2;     // golden ratio

  // ───────────── STATE ─────────────
  const canvas   = document.getElementById('c');
  const ctx      = canvas.getContext('2d');
  const depthUI  = document.getElementById('depth');
  const brightUI = document.getElementById('bright');

  let W, H;
  let baseDepth  = +depthUI.value;        // recursion from slider
  let baseAlpha  = +brightUI.value;       // max opacity
  let angleOffset= 0;                     // rotation
  let zoom       = 1;                     // current zoom
  let tZoom      = 1;                     // target zoom for smoothing

  function resize(){
    W = canvas.width  = window.innerWidth  * devicePixelRatio;
    H = canvas.height = window.innerHeight * devicePixelRatio;
    ctx.scale(devicePixelRatio, devicePixelRatio);
  }
  window.addEventListener('resize', resize);
  resize();

  // Style
  ctx.lineCap = 'round';
  ctx.globalCompositeOperation = 'lighter';

  // COLOR
  const hue = t => `hsl(${(t*360)%360},80%,65%)`;

  // Alpha per level to tame brightness
  const alphaForLevel = (lvl,total) => baseAlpha * Math.pow(0.75, (total-lvl));

  // ───────────── FRACTAL DRAW ─────────────
  function drawSpiral(level, len, totalDepth){
    if(level===0 || len<0.4) return;

    ctx.strokeStyle = hue(level/totalDepth + angleOffset/Math.PI).replace('hsl','hsla').replace('%)', `%,${alphaForLevel(level,totalDepth)})`);
    ctx.lineWidth   = Math.max(len*0.02, 0.4);

    const step = Math.PI*2 / WONDERS;
    for(let i=0;i<WONDERS;i++){
      const a  = i*step + angleOffset;
      const x2 = Math.cos(a)*len;
      const y2 = Math.sin(a)*len;

      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.lineTo(x2,y2);
      ctx.stroke();

      ctx.save();
      ctx.translate(x2,y2);
      drawSpiral(level-1, len/PHI, totalDepth);
      ctx.restore();
    }
  }

  // ───────────── MAIN LOOP ─────────────
  function loop(){
    ctx.setTransform(1,0,0,1,0,0);
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // adaptive depth based on zoom (adds detail when deep)
    const extra = Math.min(4, Math.floor(Math.log2(zoom)));
    const totalDepth = baseDepth + extra;

    // smooth zoom & gentle drift
    zoom += (tZoom - zoom)*0.08;
    zoom *= 1.001;                       // automatic flight speed
    angleOffset += 0.0025;

    // center + apply zoom
    ctx.translate(canvas.width/2, canvas.height/2);
    ctx.scale(zoom, zoom);

    drawSpiral(totalDepth, Math.min(W,H)/12, totalDepth);

    requestAnimationFrame(loop);
  }
  loop();

  // ───────────── UI EVENTS ─────────────
  depthUI.oninput  = () => baseDepth = +depthUI.value;
  brightUI.oninput = () => baseAlpha = +brightUI.value;

  document.getElementById('reset').onclick = () => {
    angleOffset = Math.random()*Math.PI*2;
    baseDepth   = Math.floor(Math.random()*3)+4;
    depthUI.value = baseDepth;
    tZoom = zoom = 1;
  };

  // Mouse‑wheel zoom control
  canvas.addEventListener('wheel', e => {
    const delta = e.deltaY>0 ? 0.9 : 1.1;
    tZoom *= delta;
    e.preventDefault();
  }, {passive:false});

  console.log('%c Awaken the Core. Illuminate the Quiet. ','background:#222;color:#0f0;padding:6px 12px;font-size:14px');
  </script>
</body>
</html>
